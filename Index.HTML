<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fade Out - Professional Screenplay Editor</title>
  <style>
    /* Dark Theme & Typography (UNCHANGED) */
    body {
      background-color: #1c0f2e;
      color: white;
      font-family: Courier, monospace;
      margin: 0;
      padding: 0;
    }
    
    body.light {
      background-color: #f8f8f8;
      color: #000000;
    }

    /* App Header (UNCHANGED) */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: #1c0f2e;
      color: white;
      text-align: center;
      padding: 10px 0;
      z-index: 1000;
      border-bottom: 1px solid #472e63;
      direction: ltr;
    }
    
    .app-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .tagline {
      font-size: 14px;
      opacity: 0.8;
    }

    /* Toolbar (Updated with new buttons) */
    .toolbar {
      position: fixed;
      top: 70px;
      left: 0;
      right: 0;
      background-color: #2a1240;
      border-bottom: 2px solid #472e63;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      z-index: 999;
      gap: 5px;
    }

    /* Toolbar Groups (UNCHANGED) */
    .toolbar-group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    /* Editor (UNCHANGED) */
    #editor {
      padding: 130px 20px 20px 20px;
      outline: none;
      white-space: pre-wrap;
      min-height: 80vh;
    }

    /* Title Page Styles (NEW) */
    .title-page {
      display: none;
      padding: 130px 20px 20px 20px;
      text-align: center;
    }
    
    .title-page input {
      background: transparent;
      border: none;
      border-bottom: 1px solid gold;
      color: inherit;
      font-family: inherit;
      font-size: inherit;
      text-align: center;
      width: 80%;
      margin: 10px auto;
      padding: 5px;
    }
    
    .title-page input:focus {
      outline: none;
    }

    /* RTL Fixes (UNCHANGED) */
    body[dir="rtl"] .toolbar {
      direction: rtl;
    }
    
    body[dir="rtl"] .toolbar button {
      float: right;
    }
    
    .rtl {
      direction: rtl;
    }

    /* Element Styles (UNCHANGED) */
    .element { margin: 0; padding: 2px 0; }
    .scene-heading { text-transform: uppercase; margin: 12px 0; text-align: left; font-weight: bold; }
    .action { text-align: left; margin: 12px 0; }
    .character { text-align: center; margin: 30px auto 10px auto; width: 60%; font-weight: bold; text-transform: uppercase; }
    .dialogue { text-align: left; margin: 0 auto 15px auto; width: 70%; }
    .parenthetical { font-style: italic; margin: 0 auto 10px auto; width: 50%; text-align: center; }
    .transition { text-align: right; margin-right: 10%; font-weight: bold; text-transform: uppercase; }
    .active-line { background-color: rgba(255, 215, 0, 0.1); }

    /* Light Mode (UNCHANGED) */
    body.light .toolbar {
      background-color: #e3e3e3;
      border-bottom: 2px solid #cccccc;
    }

    .toolbar button {
      background-color: #472e63;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 3px;
      min-width: 100px;
    }

    body.light .toolbar button {
      background-color: #dddddd;
      color: #000000;
    }

    .toolbar button.active {
      background-color: #6b458e;
    }

    /* Character suggestions (UNCHANGED) */
    #character-suggestions {
      position: absolute;
      background-color: #2a1240;
      border: 1px solid gold;
      border-radius: 3px;
      max-height: 150px;
      overflow-y: auto;
      z-index: 10;
      display: none;
    }

    body.light #character-suggestions {
      background-color: #e3e3e3;
      border: 1px solid #000000;
    }

    .character-suggestion-item {
      padding: 5px 10px;
      cursor: pointer;
    }

    .character-suggestion-item:hover {
      background-color: #472e63;
    }

    body.light .character-suggestion-item:hover {
      background-color: #cccccc;
    }

    /* Notification (UNCHANGED) */
    #notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: gold;
      color: #1c0f2e;
      padding: 10px 20px;
      border-radius: 3px;
      display: none;
      z-index: 100;
    }

    /* Modals (UNCHANGED) */
    .modal-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1001;
      justify-content: center;
      align-items: center;
    }

    .modal {
      background-color: #2a1240;
      border: 1px solid gold;
      border-radius: 5px;
      padding: 20px;
      width: 90%;
      max-width: 500px;
    }

    body.light .modal {
      background-color: #f8f8f8;
      border: 1px solid #000000;
    }

    .modal h2 {
      margin-top: 0;
      color: gold;
    }

    body.light .modal h2 {
      color: #000000;
    }

    .modal input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 3px;
      border: 1px solid gold;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    body.light .modal input {
      border: 1px solid #000000;
      background-color: white;
      color: #000000;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .cancel-btn {
      background: none;
      border: 1px solid gold;
      color: gold;
      padding: 8px 16px;
      border-radius: 3px;
      cursor: pointer;
    }

    .confirm-btn {
      background-color: gold;
      color: #1c0f2e;
      border: none;
      padding: 8px 16px;
      border-radius: 3px;
      cursor: pointer;
    }

    body.light .cancel-btn {
      border: 1px solid #000000;
      color: #000000;
    }

    body.light .confirm-btn {
      background-color: #000000;
      color: white;
    }

    /* Feedback box (UPDATED) */
    #feedback-box {
      display: none;
      margin: 10px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }

    #feedback-text {
      width: 100%;
      height: 80px;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 3px;
      border: 1px solid gold;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    body.light #feedback-text {
      border: 1px solid #000000;
      background-color: white;
      color: #000000;
    }

    #send-feedback-btn {
      background-color: gold;
      color: #1c0f2e;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 3px;
    }

    body.light #send-feedback-btn {
      background-color: #000000;
      color: white;
    }
    
    /* Transition dropdown (FIXED) */
    #transition-dropdown {
      position: absolute;
      background-color: #2a1240;
      border: 1px solid gold;
      border-radius: 3px;
      max-height: 250px;
      width: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }
    
    .transition-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .transition-item:hover {
      background-color: #472e63;
    }
    
    body.light #transition-dropdown {
      background-color: #f8f8f8;
      border: 1px solid #000;
    }
    
    body.light .transition-item:hover {
      background-color: #ddd;
    }

    /* Spellcheck Underline (NEW) */
    .spell-error {
      text-decoration: underline wavy red;
    }

    .grammar-error {
      text-decoration: underline wavy orange;
    }
  </style>
  <!-- Firebase (Optional for cloud sync) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body class="dark-mode">
  <!-- Header -->
  <div class="app-header">
    <div class="app-name">Fade Out</div>
    <div class="tagline">Write. Rewrite. Fade Out.</div>
  </div>

  <!-- Toolbar (Updated with new buttons) -->
  <div class="toolbar">
    <div>
      <button id="title-page-btn">TITLE PAGE</button>
      <button id="scene-heading-btn" class="element-button" data-type="scene-heading">SCENE HEADING</button>
      <button id="action-btn" class="element-button" data-type="action">ACTION</button>
      <button id="character-btn" class="element-button" data-type="character">CHARACTER</button>
      <button id="dialogue-btn" class="element-button" data-type="dialogue">DIALOGUE</button>
      <button id="parenthetical-btn" class="element-button" data-type="parenthetical">PARENTHETICAL</button>
      <button id="transition-btn" class="element-button" data-type="transition">TRANSITION</button>
    </div>
    <div>
      <button id="undo-btn">UNDO</button>
      <button id="redo-btn">REDO</button>
      <button id="thesaurus-btn">THESAURUS</button>
      <button id="dictionary-btn">DICTIONARY</button>
      <button id="save-btn">SAVE</button>
      <button id="load-btn">LOAD</button>
      <button id="export-btn">EXPORT</button>
      <button id="theme-toggle">LIGHT</button>
      <button id="rtl-toggle">ARABIC</button>
      <button id="feedback-btn">FEEDBACK</button>
    </div>
  </div>

  <!-- Title Page (NEW) -->
  <div id="title-page" class="title-page">
    <input type="text" id="script-title" placeholder="TITLE">
    <input type="text" id="written-by" placeholder="Written by">
    <input type="text" id="contact-email" placeholder="Email (e.g., yourname@example.com)">
    <input type="text" id="contact-phone" placeholder="Phone">
    <input type="text" id="awards" placeholder="Accolades/Awards">
    <div style="margin-top: 30px; font-size: 12px;">All copyrights reserved</div>
    <button id="start-writing-btn" style="margin-top: 20px;">START WRITING</button>
  </div>

  <!-- Editor (Starts blank) -->
  <div id="editor" class="ltr" contenteditable="true" spellcheck="false"></div>

  <!-- Character suggestions -->
  <div id="character-suggestions"></div>
  
  <!-- Transition dropdown -->
  <div id="transition-dropdown">
    <div class="transition-item" data-text="CUT TO:">CUT TO:</div>
    <div class="transition-item" data-text="FADE IN:">FADE IN:</div>
    <div class="transition-item" data-text="FADE OUT:">FADE OUT:</div>
    <div class="transition-item" data-text="FADE TO BLACK">FADE TO BLACK</div>
    <div class="transition-item" data-text="DISSOLVE TO:">DISSOLVE TO:</div>
    <div class="transition-item" data-text="SMASH CUT TO:">SMASH CUT TO:</div>
    <div class="transition-item" data-text="MATCH CUT TO:">MATCH CUT TO:</div>
    <div class="transition-item" data-text="INTERCUT WITH:">INTERCUT WITH:</div>
    <div class="transition-item" data-text="BACK TO:">BACK TO:</div>
    <div class="transition-item" data-text="THE END">THE END</div>
  </div>
  
  <!-- Notification -->
  <div id="notification">Notification Message</div>
  
  <!-- Feedback box -->
  <div id="feedback-box">
    <textarea id="feedback-text" placeholder="Enter your feedback here..."></textarea>
    <button id="send-feedback-btn">Send Feedback</button>
  </div>
  
  <!-- Save Modal -->
  <div class="modal-container" id="save-modal-container">
    <div class="modal">
      <h2>Save Script</h2>
      <input type="text" id="script-save-title" placeholder="Script Title">
      <div class="modal-buttons">
        <button class="cancel-btn" id="save-cancel">Cancel</button>
        <button class="confirm-btn" id="save-confirm">Save</button>
      </div>
    </div>
  </div>
  
  <!-- Load Modal -->
  <div class="modal-container" id="load-modal-container">
    <div class="modal">
      <h2>Load Script</h2>
      <div id="saved-scripts-list" style="max-height: 200px; overflow-y: auto; margin: 10px 0;"></div>
      <div class="modal-buttons">
        <button class="cancel-btn" id="load-cancel">Cancel</button>
        <button class="confirm-btn" id="load-confirm">Load</button>
      </div>
    </div>
  </div>
  
  <!-- Thesaurus Modal (NEW) -->
  <div class="modal-container" id="thesaurus-modal-container">
    <div class="modal">
      <h2>Thesaurus</h2>
      <div id="thesaurus-results" style="max-height: 300px; overflow-y: auto;"></div>
      <div class="modal-buttons">
        <button class="cancel-btn" id="thesaurus-cancel">Close</button>
      </div>
    </div>
  </div>
  
  <!-- Dictionary Modal (NEW) -->
  <div class="modal-container" id="dictionary-modal-container">
    <div class="modal">
      <h2>Dictionary</h2>
      <div id="dictionary-results" style="max-height: 300px; overflow-y: auto;"></div>
      <div class="modal-buttons">
        <button class="cancel-btn" id="dictionary-cancel">Close</button>
      </div>
    </div>
  </div>

  <script>
    // ========================
    // INITIALIZATION
    // ========================
    document.addEventListener('DOMContentLoaded', function() {
      // Show title page first
      showTitlePage();
      
      // Initialize Firebase (UNCOMMENT IF USING CLOUD SYNC)
      // initFirebase();
      
      // Set up the rest of the app
      setupApp();
    });

    // ========================
    // CORE FUNCTIONALITY
    // ========================
    function setupApp() {
      // Initialize elements
      const editor = document.getElementById('editor');
      const notification = document.getElementById('notification');
      
      // Start with a blank editor
      editor.innerHTML = '';
      
      // Set up event listeners
      setupListeners();
      
      // Initialize undo/redo stack
      initUndoRedo();
      
      // Set up spellcheck
      initSpellCheck();
    }

    // ========================
    // TITLE PAGE
    // ========================
    function showTitlePage() {
      document.getElementById('title-page').style.display = 'block';
      document.getElementById('editor').style.display = 'none';
      
      // Focus on title field
      document.getElementById('script-title').focus();
      
      // Start writing button
      document.getElementById('start-writing-btn').addEventListener('click', function() {
        document.getElementById('title-page').style.display = 'none';
        document.getElementById('editor').style.display = 'block';
        
        // Add first scene heading
        addNewElement('scene-heading');
      });
    }

    // ========================
    // TRANSITION DROPDOWN (FIXED)
    // ========================
    function showTransitionDropdown(element) {
      const dropdown = document.getElementById('transition-dropdown');
      if (!dropdown) return;
      
      // Position the dropdown
      const rect = element.getBoundingClientRect();
      dropdown.style.top = `${rect.bottom + window.scrollY}px`;
      dropdown.style.left = `${rect.left + window.scrollX}px`;
      
      // Show the dropdown
      dropdown.style.display = 'block';
      
      // Close when clicked outside
      setTimeout(() => {
        document.addEventListener('click', closeTransitionDropdown);
      }, 10);
    }

    function closeTransitionDropdown(e) {
      const dropdown = document.getElementById('transition-dropdown');
      if (!dropdown.contains(e.target)) {
        dropdown.style.display = 'none';
        document.removeEventListener('click', closeTransitionDropdown);
      }
    }

    // ========================
    // UNDO/REDO (NEW)
    // ========================
    let undoStack = [];
    let redoStack = [];
    let isUndoing = false;

    function initUndoRedo() {
      const editor = document.getElementById('editor');
      
      // Save state every 500ms
      setInterval(() => {
        if (!isUndoing) {
          saveState();
        }
      }, 500);
      
      // Undo button
      document.getElementById('undo-btn').addEventListener('click', undo);
      
      // Redo button
      document.getElementById('redo-btn').addEventListener('click', redo);
      
      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'z') {
          e.preventDefault();
          undo();
        } else if (e.ctrlKey && e.key === 'y') {
          e.preventDefault();
          redo();
        }
      });
    }

    function saveState() {
      const editor = document.getElementById('editor');
      undoStack.push(editor.innerHTML);
      if (undoStack.length > 50) undoStack.shift(); // Limit stack size
      redoStack = []; // Clear redo stack on new action
    }

    function undo() {
      if (undoStack.length > 0) {
        isUndoing = true;
        const editor = document.getElementById('editor');
        redoStack.push(editor.innerHTML);
        editor.innerHTML = undoStack.pop();
        isUndoing = false;
      }
    }

    function redo() {
      if (redoStack.length > 0) {
        isUndoing = true;
        const editor = document.getElementById('editor');
        undoStack.push(editor.innerHTML);
        editor.innerHTML = redoStack.pop();
        isUndoing = false;
      }
    }

    // ========================
    // THESAURUS & DICTIONARY (NEW)
    // ========================
    document.getElementById('thesaurus-btn').addEventListener('click', function() {
      const selection = window.getSelection();
      const word = selection.toString().trim();
      
      if (word) {
        showThesaurus(word);
      } else {
        showNotification('Select a word first');
      }
    });

    document.getElementById('dictionary-btn').addEventListener('click', function() {
      const selection = window.getSelection();
      const word = selection.toString().trim();
      
      if (word) {
        showDictionary(word);
      } else {
        showNotification('Select a word first');
      }
    });

    function showThesaurus(word) {
      // In a real app, this would call an API
      const modal = document.getElementById('thesaurus-modal-container');
      const results = document.getElementById('thesaurus-results');
      
      results.innerHTML = `
        <h3>Synonyms for "${word}"</h3>
        <ul>
          <li>alternative</li>
          <li>replacement</li>
          <li>equivalent</li>
        </ul>
        <h3>Antonyms</h3>
        <ul>
          <li>opposite</li>
          <li>contrary</li>
        </ul>
      `;
      
      modal.style.display = 'flex';
    }

    function showDictionary(word) {
      // In a real app, this would call an API
      const modal = document.getElementById('dictionary-modal-container');
      const results = document.getElementById('dictionary-results');
      
      results.innerHTML = `
        <h3>Definition of "${word}"</h3>
        <p>A word that represents something.</p>
        <h3>Examples</h3>
        <p>"She used the ${word} in a sentence."</p>
      `;
      
      modal.style.display = 'flex';
    }

    // ========================
    // SPELL & GRAMMAR CHECK (NEW)
    // ========================
    function initSpellCheck() {
      const editor = document.getElementById('editor');
      
      editor.addEventListener('input', function() {
        // In a real app, this would call a spellcheck API
        // This is a simplified version that marks "mispelled" as an error
        const text = editor.innerText;
        if (text.includes('mispelled')) {
          // Would need more sophisticated logic for real implementation
          showNotification('Potential spelling error detected');
        }
      });
    }

    // ========================
    // FEEDBACK TO EMAIL (NEW)
    // ========================
    document.getElementById('send-feedback-btn').addEventListener('click', function() {
      const feedbackText = document.getElementById('feedback-text').value.trim();
      
      if (feedbackText) {
        // In a real app, this would send to a server
        const mailtoLink = `mailto:Adam.st@yahoo.com?subject=Fade%20Out%20Feedback&body=${encodeURIComponent(feedbackText)}`;
        window.location.href = mailtoLink;
        
        showNotification('Feedback sent!');
        document.getElementById('feedback-text').value = '';
        document.getElementById('feedback-box').style.display = 'none';
      } else {
        showNotification('Please enter feedback');
      }
    });

    // ========================
    // FIREBASE CLOUD SYNC (OPTIONAL)
    // ========================
    function initFirebase() {
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      
      // Implement save/load from Firestore here
    }

    // ========================
    // REST OF YOUR ORIGINAL CODE
    // (All your existing functions remain unchanged)
    // ========================
    // ... [Include all your original functions here] ...
  </script>
</body>
</html>
