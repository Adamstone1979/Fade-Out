<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fade Out - Professional Screenplay Editor</title>
  <style>
    /* Dark Theme & Typography */
    body {
      background-color: #1c0f2e;
      color: white;
      font-family: Courier, monospace;
      margin: 0;
      padding: 0;
    }
    
    body.light {
      background-color: #f8f8f8;
      color: #000000;
    }

    /* App Header */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: #1c0f2e;
      color: white;
      text-align: center;
      padding: 10px 0;
      z-index: 1000;
      border-bottom: 1px solid #472e63;
      direction: ltr;
    }
    
    .app-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .tagline {
      font-size: 14px;
      opacity: 0.8;
    }

    /* Toolbar */
    .toolbar {
      position: fixed;
      top: 70px;
      left: 0;
      right: 0;
      background-color: #2a1240;
      border-bottom: 2px solid #472e63;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      z-index: 999;
      gap: 5px;
    }

    /* Toolbar Groups */
    .toolbar-group {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    /* Editor */
    #editor {
      padding: 130px 20px 20px 20px;
      outline: none;
      white-space: pre-wrap;
      min-height: 80vh;
    }

    /* Title Page Styles */
    .title-page {
      display: none;
      padding: 180px 20px 20px 20px;
      text-align: center;
    }
    
    .title-page-content {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .title-page input, .title-page textarea {
      background: transparent;
      border: none;
      border-bottom: 1px solid gold;
      color: inherit;
      font-family: inherit;
      font-size: inherit;
      text-align: center;
      width: 100%;
      margin: 15px auto;
      padding: 5px;
    }
    
    .title-page .title {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 40px;
    }
    
    .title-page .author {
      font-size: 20px;
      margin-bottom: 60px;
    }
    
    .title-page .contact {
      font-size: 16px;
      margin-top: 100px;
    }
    
    .title-page .copyright {
      font-size: 12px;
      margin-top: 120px;
    }

    /* RTL Fixes */
    body[dir="rtl"] {
      direction: rtl;
    }
    
    body[dir="rtl"] .toolbar {
      direction: rtl;
    }
    
    .rtl-element {
      direction: rtl;
      text-align: right;
    }
    
    .rtl-element.scene-heading, 
    .rtl-element.action {
      text-align: right;
    }
    
    .rtl-element.transition {
      text-align: left;
    }

    /* Element Styles */
    .element { margin: 0; padding: 2px 0; }
    .scene-heading { text-transform: uppercase; margin: 12px 0; text-align: left; font-weight: bold; }
    .action { text-align: left; margin: 12px 0; }
    .character { text-align: center; margin: 30px auto 10px auto; width: 60%; font-weight: bold; text-transform: uppercase; }
    .dialogue { text-align: left; margin: 0 auto 15px auto; width: 70%; }
    .parenthetical { font-style: italic; margin: 0 auto 10px auto; width: 50%; text-align: center; }
    .transition { text-align: right; margin-right: 10%; font-weight: bold; text-transform: uppercase; }
    .active-line { background-color: rgba(255, 215, 0, 0.1); }

    /* Light Mode */
    body.light .toolbar {
      background-color: #e3e3e3;
      border-bottom: 2px solid #cccccc;
    }

    .toolbar button {
      background-color: #472e63;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 3px;
      min-width: 100px;
    }

    body.light .toolbar button {
      background-color: #dddddd;
      color: #000000;
    }

    .toolbar button.active {
      background-color: #6b458e;
    }

    /* Character suggestions */
    #character-suggestions {
      position: absolute;
      background-color: #2a1240;
      border: 1px solid gold;
      border-radius: 3px;
      max-height: 150px;
      overflow-y: auto;
      z-index: 10;
      display: none;
    }

    body.light #character-suggestions {
      background-color: #e3e3e3;
      border: 1px solid #000000;
    }

    .character-suggestion-item {
      padding: 5px 10px;
      cursor: pointer;
    }

    .character-suggestion-item:hover {
      background-color: #472e63;
    }

    body.light .character-suggestion-item:hover {
      background-color: #cccccc;
    }

    /* Notification */
    #notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: gold;
      color: #1c0f2e;
      padding: 10px 20px;
      border-radius: 3px;
      display: none;
      z-index: 100;
    }

    /* Modals */
    .modal-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1001;
      justify-content: center;
      align-items: center;
    }

    .modal {
      background-color: #2a1240;
      border: 1px solid gold;
      border-radius: 5px;
      padding: 20px;
      width: 90%;
      max-width: 500px;
    }

    body.light .modal {
      background-color: #f8f8f8;
      border: 1px solid #000000;
    }

    .modal h2 {
      margin-top: 0;
      color: gold;
    }

    body.light .modal h2 {
      color: #000000;
    }

    .modal input, .modal select {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 3px;
      border: 1px solid gold;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    body.light .modal input,
    body.light .modal select {
      border: 1px solid #000000;
      background-color: white;
      color: #000000;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .cancel-btn {
      background: none;
      border: 1px solid gold;
      color: gold;
      padding: 8px 16px;
      border-radius: 3px;
      cursor: pointer;
    }

    .confirm-btn {
      background-color: gold;
      color: #1c0f2e;
      border: none;
      padding: 8px 16px;
      border-radius: 3px;
      cursor: pointer;
    }

    body.light .cancel-btn {
      border: 1px solid #000000;
      color: #000000;
    }

    body.light .confirm-btn {
      background-color: #000000;
      color: white;
    }

    /* Feedback box */
    #feedback-box {
      display: none;
      margin: 10px;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }

    #feedback-text {
      width: 100%;
      height: 80px;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 3px;
      border: 1px solid gold;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    body.light #feedback-text {
      border: 1px solid #000000;
      background-color: white;
      color: #000000;
    }

    #send-feedback-btn {
      background-color: gold;
      color: #1c0f2e;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 3px;
    }

    body.light #send-feedback-btn {
      background-color: #000000;
      color: white;
    }
    
    /* Transition dropdown */
    #transition-dropdown {
      position: absolute;
      background-color: #2a1240;
      border: 1px solid gold;
      border-radius: 3px;
      max-height: 250px;
      width: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }
    
    .transition-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .transition-item:hover {
      background-color: #472e63;
    }
    
    body.light #transition-dropdown {
      background-color: #f8f8f8;
      border: 1px solid #000;
    }
    
    body.light .transition-item:hover {
      background-color: #ddd;
    }

    /* Thesaurus/Dictionary Results */
    .word-result {
      margin-bottom: 15px;
    }
    
    .word-type {
      font-style: italic;
      color: gold;
    }
    
    body.light .word-type {
      color: #000000;
    }
  </style>
</head>
<body class="dark-mode">
  <!-- Header -->
  <div class="app-header">
    <div class="app-name">Fade Out</div>
    <div class="tagline">Write. Rewrite. Fade Out.</div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div>
      <button id="title-page-btn">TITLE PAGE</button>
      <button id="scene-heading-btn" class="element-button active" data-type="scene-heading">SCENE HEADING</button>
      <button id="action-btn" class="element-button" data-type="action">ACTION</button>
      <button id="character-btn" class="element-button" data-type="character">CHARACTER</button>
      <button id="dialogue-btn" class="element-button" data-type="dialogue">DIALOGUE</button>
      <button id="parenthetical-btn" class="element-button" data-type="parenthetical">PARENTHETICAL</button>
      <button id="transition-btn" class="element-button" data-type="transition">TRANSITION</button>
    </div>
    <div>
      <button id="thesaurus-btn">THESAURUS</button>
      <button id="dictionary-btn">DICTIONARY</button>
      <button id="save-btn">SAVE</button>
      <button id="load-btn">LOAD</button>
      <button id="export-btn">EXPORT</button>
      <button id="theme-toggle">LIGHT</button>
      <button id="rtl-toggle">ARABIC</button>
      <button id="feedback-btn">FEEDBACK</button>
    </div>
  </div>

  <!-- Title Page -->
  <div id="title-page" class="title-page">
    <div class="title-page-content">
      <div class="title">
        <input type="text" id="script-title" placeholder="TITLE OF SCRIPT">
      </div>
      <div class="author">
        <input type="text" id="written-by" placeholder="Written by">
      </div>
      <div class="contact">
        <input type="text" id="contact-email" placeholder="Email">
        <input type="text" id="contact-phone" placeholder="Phone">
      </div>
      <div>
        <textarea id="awards" placeholder="Accolades/Awards" rows="3"></textarea>
      </div>
      <div class="copyright">
        All copyrights reserved
      </div>
      <button id="back-to-editor-btn">BACK TO EDITOR</button>
    </div>
  </div>

  <!-- Editor -->
  <div id="editor" class="ltr" contenteditable="true" spellcheck="false"></div>

  <!-- Character suggestions -->
  <div id="character-suggestions"></div>
  
  <!-- Transition dropdown -->
  <div id="transition-dropdown">
    <div class="transition-item" data-text="CUT TO:">CUT TO:</div>
    <div class="transition-item" data-text="FADE IN:">FADE IN:</div>
    <div class="transition-item" data-text="FADE OUT:">FADE OUT:</div>
    <div class="transition-item" data-text="FADE TO BLACK">FADE TO BLACK</div>
    <div class="transition-item" data-text="DISSOLVE TO:">DISSOLVE TO:</div>
    <div class="transition-item" data-text="SMASH CUT TO:">SMASH CUT TO:</div>
    <div class="transition-item" data-text="MATCH CUT TO:">MATCH CUT TO:</div>
    <div class="transition-item" data-text="INTERCUT WITH:">INTERCUT WITH:</div>
    <div class="transition-item" data-text="BACK TO:">BACK TO:</div>
    <div class="transition-item" data-text="THE END">THE END</div>
  </div>
  
  <!-- Notification -->
  <div id="notification">Notification Message</div>
  
  <!-- Feedback box -->
  <div id="feedback-box">
    <textarea id="feedback-text" placeholder="Enter your feedback here..."></textarea>
    <button id="send-feedback-btn">Send Feedback</button>
  </div>
  
  <!-- Save Modal -->
  <div class="modal-container" id="save-modal-container">
    <div class="modal">
      <h2>Save Script</h2>
      <input type="text" id="save-script-title" placeholder="Script Title">
      <div class="modal-buttons">
        <button class="cancel-btn" id="save-cancel">Cancel</button>
        <button class="confirm-btn" id="save-confirm">Save</button>
      </div>
    </div>
  </div>
  
  <!-- Load Modal -->
  <div class="modal-container" id="load-modal-container">
    <div class="modal">
      <h2>Load Script</h2>
      <div id="saved-scripts-list" style="max-height: 200px; overflow-y: auto; margin: 10px 0;"></div>
      <div class="modal-buttons">
        <button class="cancel-btn" id="load-cancel">Cancel</button>
        <button class="confirm-btn" id="load-confirm">Load</button>
      </div>
    </div>
  </div>
  
  <!-- Export Modal -->
  <div class="modal-container" id="export-modal-container">
    <div class="modal">
      <h2>Export Script</h2>
      <select id="export-format">
        <option value="pdf">PDF</option>
        <option value="fdx">Final Draft (FDX)</option>
      </select>
      <div class="modal-buttons">
        <button class="cancel-btn" id="export-cancel">Cancel</button>
        <button class="confirm-btn" id="export-confirm">Export</button>
      </div>
    </div>
  </div>
  
  <!-- Thesaurus Modal -->
  <div class="modal-container" id="thesaurus-modal-container">
    <div class="modal">
      <h2>Thesaurus</h2>
      <div id="thesaurus-results"></div>
      <div class="modal-buttons">
        <button class="cancel-btn" id="thesaurus-cancel">Close</button>
      </div>
    </div>
  </div>
  
  <!-- Dictionary Modal -->
  <div class="modal-container" id="dictionary-modal-container">
    <div class="modal">
      <h2>Dictionary</h2>
      <div id="dictionary-results"></div>
      <div class="modal-buttons">
        <button class="cancel-btn" id="dictionary-cancel">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Arabic translations
    const arabicLabels = {
      'SCENE HEADING': 'العنوان الرئيسي',
      'ACTION': 'الفعل',
      'CHARACTER': 'الشخصية',
      'DIALOGUE': 'الحوار',
      'PARENTHETICAL': 'توضيح',
      'TRANSITION': 'الانتقال',
      'TITLE PAGE': 'صفحة العنوان',
      'THESAURUS': 'المعجم',
      'DICTIONARY': 'القاموس',
      'SAVE': 'حفظ',
      'LOAD': 'تحميل',
      'EXPORT': 'تصدير',
      'FEEDBACK': 'تعليق',
      'ARABIC': 'English',
      'ENGLISH': 'عربي',
      'LIGHT': 'مضيء',
      'DARK': 'مظلم',
      'BACK TO EDITOR': 'العودة إلى المحرر'
    };

    // Global state
    let currentElement = 'scene-heading';
    let isRtlMode = false;
    let scriptCharacters = new Set();
    let undoStack = [];
    let redoStack = [];
    let isUndoing = false;

    // Initialize the editor
    document.addEventListener('DOMContentLoaded', function() {
      // Start with blank editor
      document.getElementById('editor').style.display = 'block';
      addNewElement('scene-heading');
      
      // Set up event listeners
      setupListeners();
    });

    function setupListeners() {
      const editor = document.getElementById('editor');
      const notification = document.getElementById('notification');
      
      // Title page button
      document.getElementById('title-page-btn').addEventListener('click', function() {
        document.getElementById('title-page').style.display = 'block';
        document.getElementById('editor').style.display = 'none';
      });
      
      // Back to editor button
      document.getElementById('back-to-editor-btn').addEventListener('click', function() {
        document.getElementById('title-page').style.display = 'none';
        document.getElementById('editor').style.display = 'block';
      });

      // Element type buttons
      document.querySelectorAll('.element-button').forEach(btn => {
        btn.addEventListener('click', function() {
          currentElement = this.dataset.type;
          document.querySelectorAll('.element-button').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          addNewElement(currentElement);
        });
      });
      
      // Action buttons
      document.getElementById('save-btn').addEventListener('click', saveScript);
      document.getElementById('load-btn').addEventListener('click', loadScript);
      document.getElementById('export-btn').addEventListener('click', showExportModal);
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
      document.getElementById('rtl-toggle').addEventListener('click', toggleDirection);
      document.getElementById('feedback-btn').addEventListener('click', toggleFeedback);
      document.getElementById('thesaurus-btn').addEventListener('click', showThesaurus);
      document.getElementById('dictionary-btn').addEventListener('click', showDictionary);
      
      // Modal buttons
      document.getElementById('save-cancel').addEventListener('click', () => {
        document.getElementById('save-modal-container').style.display = 'none';
      });
      
      document.getElementById('save-confirm').addEventListener('click', () => {
        const title = document.getElementById('save-script-title').value.trim() || 'Untitled Script';
        const content = editor.innerHTML;
        
        // Save to localStorage
        const scripts = JSON.parse(localStorage.getItem('scripts') || '{}');
        scripts[title] = {
          content,
          characters: Array.from(scriptCharacters),
          timestamp: Date.now(),
          title: document.getElementById('script-title').value,
          author: document.getElementById('written-by').value,
          contact: {
            email: document.getElementById('contact-email').value,
            phone: document.getElementById('contact-phone').value
          },
          awards: document.getElementById('awards').value
        };
        localStorage.setItem('scripts', JSON.stringify(scripts));
        
        document.getElementById('save-modal-container').style.display = 'none';
        showNotification(`Script "${title}" saved successfully`);
      });
      
      document.getElementById('load-cancel').addEventListener('click', () => {
        document.getElementById('load-modal-container').style.display = 'none';
      });
      
      document.getElementById('load-confirm').addEventListener('click', () => {
        const selected = document.querySelector('.saved-script-item.selected');
        if (!selected) {
          showNotification('Please select a script to load');
          return;
        }
        
        const scriptName = selected.getAttribute('data-name');
        const scripts = JSON.parse(localStorage.getItem('scripts') || '{}');
        
        if (scripts[scriptName]) {
          editor.innerHTML = scripts[scriptName].content;
          if (scripts[scriptName].characters) {
            scriptCharacters = new Set(scripts[scriptName].characters);
          }
          
          // Load title page info
          document.getElementById('script-title').value = scripts[scriptName].title || '';
          document.getElementById('written-by').value = scripts[scriptName].author || '';
          document.getElementById('contact-email').value = scripts[scriptName].contact?.email || '';
          document.getElementById('contact-phone').value = scripts[scriptName].contact?.phone || '';
          document.getElementById('awards').value = scripts[scriptName].awards || '';
          
          document.getElementById('load-modal-container').style.display = 'none';
          showNotification(`Script "${scriptName}" loaded successfully`);
        }
      });
      
      document.getElementById('export-cancel').addEventListener('click', () => {
        document.getElementById('export-modal-container').style.display = 'none';
      });
      
      document.getElementById('export-confirm').addEventListener('click', () => {
        const format = document.getElementById('export-format').value;
        exportScript(format);
      });
      
      document.getElementById('send-feedback-btn').addEventListener('click', () => {
        const feedbackText = document.getElementById('feedback-text').value.trim();
        if (!feedbackText) {
          showNotification('Please enter your feedback');
          return;
        }
        
        const mailtoLink = `mailto:Adam.st@yahoo.com?subject=Fade%20Out%20Feedback&body=${encodeURIComponent(feedbackText)}`;
        window.location.href = mailtoLink;
        showNotification('Feedback sent!');
        document.getElementById('feedback-text').value = '';
        document.getElementById('feedback-box').style.display = 'none';
      });
      
      document.getElementById('thesaurus-cancel').addEventListener('click', () => {
        document.getElementById('thesaurus-modal-container').style.display = 'none';
      });
      
      document.getElementById('dictionary-cancel').addEventListener('click', () => {
        document.getElementById('dictionary-modal-container').style.display = 'none';
      });
      
      // Editor events
      editor.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          handleEnterKey();
        } else if
